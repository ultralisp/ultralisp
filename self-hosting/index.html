<html lang=en>
 <head>
  <meta charset=UTF-8><meta name=viewport
      content="width=device-width, initial-scale=1">
  <title>How to host Ultralisp on my own server</title>
  <link rel=alternate
        href="https://ultralisp.github.io/ultralisp/changelog.xml"
        type="application/rss+xml">
  <link rel=stylesheet type="text/css"
        href="../theme.css">
  <script type="text/javascript" src="../jquery.js"></script>
  <script type="text/javascript" src="../toc.js"></script>
  <script type="text/javascript">$(document).ready(function() {$('a:has(img)').css('border-bottom', 'none')})</script>
  <link rel=stylesheet type="text/css"
      href="../highlight.min.css">
  <script type="text/javascript"
          src="../highlight.min.js"></script>
  <script type="text/javascript">hljs.highlightAll();</script>
 </head>
 <body>
  <div class=page><div class=sidebar><div class=header><form class=search method=GET
      action="../search/">
      <input type=text name=q>
      <input type=submit value=Search><span id=search-progress></span>
     </form>
    </div><div class=content><div class=page-toc><ul><li><p><a href="../#x-28ULTRALISP-DOCS-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../" data-node="x-28ULTRALISP-DOCS-2FINDEX-3A-40INDEX-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Introduction</a></p><ul><li><p><a href="../#what-is-this" data-document="../" data-node="what-is-this">What is this?</a></p></li><li><p><a href="../#how-to-use-it" data-document="../" data-node="how-to-use-it">How to use it?</a></p></li></ul></li><li><p><a href="../architecture/#x-28ULTRALISP-DOCS-2FARCHITECTURE-3A-3A-40ARCHITECTURE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../architecture/" data-node="x-28ULTRALISP-DOCS-2FARCHITECTURE-3A-3A-40ARCHITECTURE-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Architecture</a></p><ul><li><p><a href="../architecture/#components-of-the-system" data-document="../architecture/" data-node="components-of-the-system">Components of the system</a></p><ul><li><p><a href="../architecture/#main-app" data-document="../architecture/" data-node="main-app">MainApp</a></p></li><li><p><a href="../architecture/#worker" data-document="../architecture/" data-node="worker">Worker</a></p></li><li><p><a href="../architecture/#gearman" data-document="../architecture/" data-node="gearman">Gearman</a></p></li><li><p><a href="../architecture/#file-storage" data-document="../architecture/" data-node="file-storage">FileStorage</a></p></li></ul></li></ul></li><li><p><a href="../dev/#x-28ULTRALISP-DOCS-2FDEV-3A-3A-40DEV-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../dev/" data-node="x-28ULTRALISP-DOCS-2FDEV-3A-3A-40DEV-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Development</a></p><ul><li><p><a href="../dev/#running-in-dev" data-document="../dev/" data-node="running-in-dev">Running in dev</a></p><ul><li><p><a href="../dev/#easy-way" data-document="../dev/" data-node="easy-way">Easy way</a></p></li></ul></li><li><p><a href="../dev/#harder-way" data-document="../dev/" data-node="harder-way">Harder way</a></p><ul><li><p><a href="../dev/#database-setup" data-document="../dev/" data-node="database-setup">Database setup</a></p></li><li><p><a href="../dev/#building-and-running-lisp-components" data-document="../dev/" data-node="building-and-running-lisp-components">Building and running lisp components</a></p></li><li><p><a href="../dev/#connecting-worker-to-the-main-application" data-document="../dev/" data-node="connecting-worker-to-the-main-application">Connecting worker to the main application</a></p></li><li><p><a href="../dev/#checking-if-everything-works" data-document="../dev/" data-node="checking-if-everything-works">Checking if everything works</a></p></li><li><p><a href="../dev/#building-the-search-index" data-document="../dev/" data-node="building-the-search-index">Building the search index</a></p></li></ul></li></ul></li><li><p><a href="#x-28ULTRALISP-DOCS-2FSELF-HOSTING-3A-3A-40SELF-HOSTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="" data-node="x-28ULTRALISP-DOCS-2FSELF-HOSTING-3A-3A-40SELF-HOSTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">How to host Ultralisp on my own server</a></p><ul><li><p><a href="#easy-way" data-document="" data-node="easy-way">Easy way</a></p></li><li><p><a href="#harder-way" data-document="" data-node="harder-way">Harder way</a></p></li><li><p><a href="#uploading-distribution-to-s3" data-document="" data-node="uploading-distribution-to-s3">Uploading distribution to S3</a></p><ul><li><p><a href="#how-to-create-a-bucket" data-document="" data-node="how-to-create-a-bucket">How to create a bucket</a></p></li><li><p><a href="#setup-a-proxy-server" data-document="" data-node="setup-a-proxy-server">Setup a proxy server</a></p></li></ul></li></ul></li><li><p><a href="../hacking/#x-28ULTRALISP-DOCS-2FHACKING-3A-3A-40HACKING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../hacking/" data-node="x-28ULTRALISP-DOCS-2FHACKING-3A-3A-40HACKING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">Hacking around</a></p><ul><li><p><a href="../hacking/#running-and-creating-database-migrations" data-document="../hacking/" data-node="running-and-creating-database-migrations">Running and creating database migrations</a></p></li><li><p><a href="../hacking/#running-tests" data-document="../hacking/" data-node="running-tests">Running tests</a></p></li><li><p><a href="../hacking/#interesting-environment-variables" data-document="../hacking/" data-node="interesting-environment-variables">Interesting environment variables</a></p></li></ul></li><li><p><a href="../releases/#x-28ULTRALISP-DOCS-2FRELEASES-3A-3A-40RELEASES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="../releases/" data-node="x-28ULTRALISP-DOCS-2FRELEASES-3A-3A-40RELEASES-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29">How to release new Ultralisp version</a></p><ul><li><p><a href="../releases/#making-a-new-release" data-document="../releases/" data-node="making-a-new-release">Making a new release</a></p></li></ul></li></ul>
     </div>
    </div><div class=footer>
     <a href="https://40ants.com/doc">[generated by 40ANTS-DOC]</a>
    </div>
   </div><div class=content role=main><h1>How to host Ultralisp on my own server<a class=header-link
     href=#x-28ULTRALISP-DOCS-2FSELF-HOSTING-3A-3A-40SELF-HOSTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29
     title="Permalink to this headline"
     id=x-28ULTRALISP-DOCS-2FSELF-HOSTING-3A-3A-40SELF-HOSTING-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29></a></h1><h2 id="easy-way">Easy way</h2><p>The easiest way to start a local Ultralisp server is to use
<code>docker compose</code>.</p><p>Checkout the repository:</p><pre><code class="bash">git clone https://github.com/ultralisp/ultralisp
cd ultralisp</code></pre><p>And run:</p><pre><code class="bash">docker compose run --rm mito migrate
docker compose up app</code></pre><p><b>Note, you have at least <code>4G</code> of <code>RAM</code> on your machine, to run all services, needed for Ultralisp!</b></p><h2 id="harder-way">Harder way</h2><p>You may also build docker images out of Dockerfile and run them manually like this:</p><pre><code class="bash">docker run --rm \
           --name ultralisp \
           -p 80:80 \
           -p 4005:4005 \
           -v `pwd`:/app \
           -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
           -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
           -e RESEND_API_KEY=key-xxxxxxxxxxxxx \
           -e USER_AGENT=xxxxxxxxxxxxx \
           40ants/ultralisp:latest</code></pre><p>See the full list of env variables need by each component in the <code>common-services.yaml</code> file.</p><p>Also, you might choose to build each component manuall. See the instruction in the <a href="https://ultralisp.github.io/ultralisp/dev/#x-28ULTRALISP-DOCS-2FDEV-3A-3A-40DEV-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29" data-document="https://ultralisp.github.io/ultralisp/dev/" data-node="x-28ULTRALISP-DOCS-2FDEV-3A-3A-40DEV-2040ANTS-DOC-2FLOCATIVES-3ASECTION-29"><code>Development</code></a> section.</p><h2 id="uploading-distribution-to-s3">Uploading distribution to S3</h2><p>By default, Ultralisp stores data locally and serves it from the
<code>/dist/</code> folder, like that:
<code>http://my-ultralisp.org/dist/</code>. Hovewer, you may want to upload the
data to Amazon <code>S3</code> and to serve it through something like Cloudflare.</p><p>To do this, you need to set these environment variables for ultralisp
app:</p><ul><li><p><code>UPLOADER_TYPE=s3</code></p></li><li><p><code>S3_BUCKET=dist.my-ultralisp.org</code></p></li><li><p><code>AWS_ACCESS_KEY_ID=*****</code></p></li><li><p><code>AWS_SECRET_ACCESS_KEY=*****</code></p></li><li><p><code>BASE_URL=http://dist.my-ultralisp.org/</code> - a <code>URL</code> of the server which will
  serve the files. In simplest case, you would just point to <code>S3</code> server
  like that: https://s3.amazonaws.com/dist.my-ultralisp.org/ but right
  now this will not work because Quicklisp does not support <code>HTTPS</code> :(</p></li></ul><p>And you need to create a bucket on the <code>S3</code>.</p><h3 id="how-to-create-a-bucket">How to create a bucket</h3><ul><li><p>Go to the <code>AWS</code> console: https://s3.console.aws.amazon.com/s3/home</p></li><li><p>Press https://s3.console.aws.amazon.com/s3/home?region=us-east-1#</p></li><li><p>Set you bucket's name such as a domain, like <code>dist.my-ultralisp.org</code></p></li><li><p>On a tab &quot;Set permissions&quot; remove ticks from these items:</p></li><li><p>Block new public <code>ACL</code>s and uploading public objects</p></li><li><p>Remove public access granted through public <code>ACL</code>s</p></li><li><p>Block new public bucket policies</p></li><li><p>Block public and cross-account access if bucket has public policies</p></li><li><p>When the bucket is created, go to the buckets policy page which should have
  an url like that: https://s3.console.aws.amazon.com/s3/buckets/dist.my-ultralisp.org/?region=us-east-1&amp;tab=permissions
  and insert such code into the &quot;Bucket Policy&quot; tab:</p><pre><code class="javascrip">{
  &quot;Id&quot;: &quot;Policy1547940357563&quot;,
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;Stmt1547940349039&quot;,
      &quot;Action&quot;: [
        &quot;s3:GetObject&quot;
      ],
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;arn:aws:s3:::dist.my-ultralisp.org/*&quot;,
      &quot;Principal&quot;: &quot;*&quot;
    }
  ]
}</code></pre></li></ul><p>This will make this bucket readable to anybody.</p><h3 id="setup-a-proxy-server">Setup a proxy server</h3><p>You need a proxy or <code>CDN</code> which is able to serve data via plain <code>HTTP</code>,
because Quicklisp client does not support <code>HTTPS</code> yet. There is an
<code>issue &lt;https://github.com/quicklisp/quicklisp-client/issues/167&gt;</code>_ on
the GitHub, please, vote for it.</p><p>I use Cloudflare because it is free and easy to setup.</p><p>To serve files via Cloudflare, turn on &quot;Static website hosting&quot; of the
bucket at <code>AWS</code>. Set the &quot;index document&quot; as &quot;ultralisp.txt&quot;.</p><p>After that, your quicklisp distribution will be available as http://dist.ultralisp.org.s3-website-eu-west-1.amazonaws.com</p>
   </div>
  </div>
 </body>
</html>